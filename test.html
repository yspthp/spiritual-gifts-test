<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å±¬éˆæ©è³œè©•æ¸¬ - æ¸¬é©—é€²è¡Œä¸­</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
  
  <!-- é€²åº¦æ¢ -->
  <div class="fixed top-0 left-0 w-full bg-white shadow-sm z-50">
    <div class="max-w-4xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between mb-2">
        <span class="text-sm text-gray-600">é€²åº¦</span>
        <span class="text-sm font-semibold text-blue-600" id="progress-text">1/100</span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 1%"></div>
      </div>
    </div>
  </div>

  <!-- ä¸»è¦å…§å®¹ -->
  <div class="pt-24 pb-12 min-h-screen">
    <div class="max-w-3xl mx-auto px-4">
      
      <!-- å•é¡Œå¡ç‰‡ -->
      <div class="bg-white rounded-2xl shadow-lg p-8 md:p-12">
        
        <!-- æ©è³œæ¨™ç±¤ -->
        <div class="text-center mb-6">
          <div class="inline-flex items-center gap-2 px-4 py-2 bg-blue-50 rounded-full">
            <span id="gift-icon" class="text-2xl">ğŸ“‹</span>
            <span id="gift-name" class="font-semibold text-blue-900">æ²»ç† Administration</span>
          </div>
        </div>

        <!-- å•é¡Œæ–‡å­— -->
        <div class="text-center mb-12">
          <p id="question-text" class="text-xl md:text-2xl text-gray-800 leading-relaxed">
            å•é¡Œè¼‰å…¥ä¸­...
          </p>
        </div>

        <!-- ä¸‰é¸é … -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
          
          <!-- é¸é …ï¼šæœ‰ -->
          <button onclick="selectAnswer('æœ‰')" 
                  class="answer-btn group relative overflow-hidden bg-white border-2 border-gray-200 rounded-xl p-6 hover:border-green-500 hover:shadow-lg transition-all duration-200 hover:scale-105"
                  data-value="æœ‰">
            <div class="text-center">
              <div class="text-4xl mb-3 group-hover:scale-110 transition-transform">âœ“</div>
              <div class="text-xl font-bold text-gray-800 mb-1">æœ‰</div>
              <div class="text-sm text-gray-500">This is me</div>
            </div>
          </button>

          <!-- é¸é …ï¼šæˆ–è¨±æœ‰ -->
          <button onclick="selectAnswer('æˆ–è¨±æœ‰')" 
                  class="answer-btn group relative overflow-hidden bg-white border-2 border-gray-200 rounded-xl p-6 hover:border-yellow-500 hover:shadow-lg transition-all duration-200 hover:scale-105"
                  data-value="æˆ–è¨±æœ‰">
            <div class="text-center">
              <div class="text-4xl mb-3 group-hover:scale-110 transition-transform">?</div>
              <div class="text-xl font-bold text-gray-800 mb-1">æˆ–è¨±æœ‰</div>
              <div class="text-sm text-gray-500">Not sure</div>
            </div>
          </button>

          <!-- é¸é …ï¼šæ²’æœ‰ -->
          <button onclick="selectAnswer('æ²’æœ‰')" 
                  class="answer-btn group relative overflow-hidden bg-white border-2 border-gray-200 rounded-xl p-6 hover:border-gray-400 hover:shadow-lg transition-all duration-200 hover:scale-105"
                  data-value="æ²’æœ‰">
            <div class="text-center">
              <div class="text-4xl mb-3 group-hover:scale-110 transition-transform">âœ—</div>
              <div class="text-xl font-bold text-gray-800 mb-1">æ²’æœ‰</div>
              <div class="text-sm text-gray-500">Not me</div>
            </div>
          </button>

        </div>

         <!-- å°èˆªæŒ‰éˆ• -->
        <div class="flex justify-between items-center">
          <button onclick="previousQuestion()" 
                  id="prev-btn"
                  class="px-6 py-3 text-gray-600 hover:text-gray-800 font-medium rounded-lg hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            â† ä¸Šä¸€é¡Œ
          </button>
          
          <div class="text-sm text-gray-500">
            æç¤ºï¼šå¯ä½¿ç”¨éµç›¤ 1, 2, 3 å¿«é€Ÿä½œç­”
          </div>

          <button onclick="nextQuestion()" 
                  id="next-btn"
                  class="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            ä¸‹ä¸€é¡Œ â†’
          </button>
        </div>

      </div>

      <!-- é¼“å‹µè¨Šæ¯ï¼ˆæ¯20é¡Œé¡¯ç¤ºï¼‰ -->
      <div id="encouragement" class="hidden mt-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 text-center">
        <div class="text-3xl mb-2">ğŸ‰</div>
        <div class="text-lg font-semibold text-gray-800 mb-1">åšå¾—å¥½ï¼</div>
        <div class="text-gray-600">ä½ å·²ç¶“å®Œæˆ <span id="encourage-percent">20</span>% çš„æ¸¬é©—</div>
      </div>

    </div>
  </div>

  <!-- å®Œæˆæ¸¬é©—å½ˆçª— -->
  <div id="complete-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full text-center animate-bounce-in">
      <div class="text-6xl mb-4">âœ¨</div>
      <h2 class="text-2xl font-bold text-gray-800 mb-2">æ­å–œå®Œæˆæ¸¬é©—ï¼</h2>
      <p class="text-gray-600 mb-6">æ­£åœ¨ç‚ºä½ åˆ†æçµæœ...</p>
      <div class="flex justify-center mb-6">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
      <button onclick="goToResults()" class="w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors">
        æŸ¥çœ‹æˆ‘çš„æ©è³œå ±å‘Š â†’
      </button>
    </div>
  </div>

  <!-- è¼‰å…¥ JS æª”æ¡ˆ - é †åºå¾ˆé‡è¦ï¼ -->
  <script src="js/gifts-data.js"></script>
  <script src="js/questions-data.js"></script>
  <script src="js/test.js"></script>
  
  <script>
    // ==========================================
    // å…¨åŸŸè®Šæ•¸
    // ==========================================
    var test = null;

    // ==========================================
    // åˆå§‹åŒ–æ¸¬é©—
    // ==========================================
    function initTest() {
      console.log('=== é–‹å§‹åˆå§‹åŒ–æ¸¬é©— ===');
      
      // æª¢æŸ¥è³‡æ–™æ˜¯å¦è¼‰å…¥
      if (typeof GIFTS_DATA === 'undefined') {
        console.error('âŒ GIFTS_DATA æœªè¼‰å…¥ï¼');
        alert('éŒ¯èª¤ï¼šæ©è³œè³‡æ–™æœªè¼‰å…¥ï¼Œè«‹æª¢æŸ¥ js/gifts-data.js');
        return;
      } else {
        console.log('âœ“ GIFTS_DATA å·²è¼‰å…¥ï¼Œå…±', GIFTS_DATA.length, 'å€‹æ©è³œ');
      }
      
      if (typeof QUESTIONS === 'undefined') {
        console.error('âŒ QUESTIONS æœªè¼‰å…¥ï¼');
        alert('éŒ¯èª¤ï¼šå•é¡Œè³‡æ–™æœªè¼‰å…¥ï¼Œè«‹æª¢æŸ¥ js/questions-data.js');
        return;
      } else {
        console.log('âœ“ QUESTIONS å·²è¼‰å…¥ï¼Œå…±', QUESTIONS.length, 'é¡Œ');
      }
      
      if (typeof SpiritualGiftsTest === 'undefined') {
        console.error('âŒ SpiritualGiftsTest æœªè¼‰å…¥ï¼');
        alert('éŒ¯èª¤ï¼šæ¸¬é©—é¡åˆ¥æœªè¼‰å…¥ï¼Œè«‹æª¢æŸ¥ js/test.js');
        return;
      } else {
        console.log('âœ“ SpiritualGiftsTest é¡åˆ¥å·²è¼‰å…¥');
      }

      // åˆå§‹åŒ–æ¸¬é©—ç‰©ä»¶
      test = new SpiritualGiftsTest();
      console.log('âœ“ æ¸¬é©—ç‰©ä»¶å·²å»ºç«‹');
      console.log('ç•¶å‰é€²åº¦:', test.currentIndex + 1, '/', test.questions.length);
      console.log('å·²å›ç­”:', Object.keys(test.answers).length, 'é¡Œ');
      
      // æ¸²æŸ“ç¬¬ä¸€é¡Œ
      renderQuestion();
      console.log('=== åˆå§‹åŒ–å®Œæˆ ===');
    }

    // ==========================================
    // æ¸²æŸ“ç•¶å‰å•é¡Œ
    // ==========================================
    function renderQuestion() {
      if (!test) {
        console.error('test ç‰©ä»¶å°šæœªåˆå§‹åŒ–');
        return;
      }

      const question = test.getCurrentQuestion();
      const gift = GIFTS_DATA.find(g => g.id === question.giftId);
      
      console.log('æ¸²æŸ“å•é¡Œ', question.id, ':', question.text.substring(0, 30) + '...');
      
      // æ›´æ–°å•é¡Œå…§å®¹
      document.getElementById('gift-icon').textContent = gift.icon;
      document.getElementById('gift-name').textContent = `${gift.name.zh} ${gift.name.en}`;
      document.getElementById('question-text').textContent = question.text;
      
      // æ›´æ–°é€²åº¦
      const progress = test.getProgress();
      document.getElementById('progress-bar').style.width = progress + '%';
      document.getElementById('progress-text').textContent = `${test.currentIndex + 1}/100`;
      
      // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
      document.getElementById('prev-btn').disabled = test.currentIndex === 0;
      
      // æ¸…é™¤é¸ä¸­ç‹€æ…‹
      document.querySelectorAll('.answer-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      // å¦‚æœå·²å›ç­”ï¼Œé¡¯ç¤ºé¸ä¸­ç‹€æ…‹
      const currentAnswer = test.answers[question.id];
      if (currentAnswer) {
        const selectedBtn = document.querySelector(`[data-value="${currentAnswer.value}"]`);
        if (selectedBtn) {
          selectedBtn.classList.add('selected');
        }
      }
      
      // é¡¯ç¤ºé¼“å‹µè¨Šæ¯
      showEncouragement();
    }

    // ==========================================
    // é¸æ“‡ç­”æ¡ˆ
    // ==========================================
    function selectAnswer(value) {
      if (!test) {
        console.error('test ç‰©ä»¶å°šæœªåˆå§‹åŒ–');
        alert('ç³»çµ±å°šæœªæº–å‚™å¥½ï¼Œè«‹ç¨å€™å†è©¦');
        return;
      }

      console.log('é¸æ“‡ç­”æ¡ˆ:', value);
      test.answer(value);
      
      // è¦–è¦ºå›é¥‹
      document.querySelectorAll('.answer-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      const btn = document.querySelector(`[data-value="${value}"]`);
      if (btn) {
        btn.classList.add('selected');
      }
      
      // 0.5ç§’å¾Œè‡ªå‹•è·³ä¸‹ä¸€é¡Œ
      setTimeout(() => {
        if (test.currentIndex < test.questions.length - 1) {
          test.next();
          renderQuestion();
        } else {
          // å®Œæˆæ¸¬é©—
          console.log('=== æ¸¬é©—å®Œæˆï¼===');
          showCompleteModal();
        }
      }, 500);
    }

    // ==========================================
    // ä¸Šä¸€é¡Œ
    // ==========================================
    function previousQuestion() {
      if (!test) return;
      
      if (test.previous()) {
        renderQuestion();
      }
    }

    // ==========================================
    // ä¸‹ä¸€é¡Œ
    // ==========================================
    function nextQuestion() {
      if (!test) return;
      
      const question = test.getCurrentQuestion();
      const currentAnswer = test.answers[question.id];
      
      if (!currentAnswer) {
        alert('è«‹å…ˆé¸æ“‡ä¸€å€‹ç­”æ¡ˆ');
        return;
      }
      
      if (test.next()) {
        renderQuestion();
      } else {
        // æœ€å¾Œä¸€é¡Œ
        console.log('=== æ¸¬é©—å®Œæˆï¼===');
        showCompleteModal();
      }
    }

    // ==========================================
    // é¡¯ç¤ºé¼“å‹µè¨Šæ¯
    // ==========================================
    function showEncouragement() {
      if (!test) return;
      
      const encouragement = document.getElementById('encouragement');
      const currentNum = test.currentIndex + 1;
      
      if (currentNum % 20 === 0 && currentNum < 100) {
        const percent = (currentNum / 100) * 100;
        document.getElementById('encourage-percent').textContent = percent;
        encouragement.classList.remove('hidden');
        
        setTimeout(() => {
          encouragement.classList.add('hidden');
        }, 3000);
      } else {
        encouragement.classList.add('hidden');
      }
    }

    // ==========================================
    // é¡¯ç¤ºå®Œæˆå½ˆçª—
    // ==========================================
    function showCompleteModal() {
      if (!test) return;
      
      document.getElementById('complete-modal').classList.remove('hidden');
      
      // è¨ˆç®—çµæœ
      console.log('é–‹å§‹è¨ˆç®—çµæœ...');
      const results = test.calculateResults();
      console.log('çµæœè¨ˆç®—å®Œæˆï¼Œå‰5å:');
      results.slice(0, 5).forEach((g, i) => {
        console.log(`${i+1}. ${g.name.zh}: ${g.totalScore}/15 (${g.percentage}%)`);
      });
      
      // 2ç§’å¾Œè‡ªå‹•è·³è½‰
      setTimeout(() => {
        goToResults();
      }, 2000);
    }

    // ==========================================
    // å‰å¾€çµæœé 
    // ==========================================
    function goToResults() {
      console.log('è·³è½‰åˆ°çµæœé ');
      window.location.href = 'result.html';
    }

    // ==========================================
    // éµç›¤å¿«æ·éµ
    // ==========================================
    document.addEventListener('keydown', (e) => {
      if (!test) return;
      
      if (e.key === '1' || e.key.toLowerCase() === 'y') {
        selectAnswer('æœ‰');
      } else if (e.key === '2' || e.key.toLowerCase() === 'm') {
        selectAnswer('æˆ–è¨±æœ‰');
      } else if (e.key === '3' || e.key.toLowerCase() === 'n') {
        selectAnswer('æ²’æœ‰');
      } else if (e.key === 'ArrowLeft') {
        previousQuestion();
      } else if (e.key === 'ArrowRight') {
        nextQuestion();
      }
    });

    // ==========================================
    // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    // ==========================================
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTest);
    } else {
      // DOM å·²ç¶“è¼‰å…¥å®Œæˆ
      initTest();
    }
  </script>

  <style>
    .answer-btn.selected {
      transform: scale(1.05);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }
    
    .answer-btn.selected[data-value="æœ‰"] {
      border-color: #10B981 !important;
      background-color: #10B981 !important;
      color: white !important;
    }
    
    .answer-btn.selected[data-value="æˆ–è¨±æœ‰"] {
      border-color: #F59E0B !important;
      background-color: #F59E0B !important;
      color: white !important;
    }
    
    .answer-btn.selected[data-value="æ²’æœ‰"] {
      border-color: #6B7280 !important;
      background-color: #6B7280 !important;
      color: white !important;
    }

    .answer-btn.selected .text-gray-800,
    .answer-btn.selected .text-gray-500 {
      color: white !important;
    }

    @keyframes bounce-in {
      0% {
        transform: scale(0.8);
        opacity: 0;
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .animate-bounce-in {
      animation: bounce-in 0.5s ease-out;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .animate-spin {
      animation: spin 1s linear infinite;
    }
  </style>

</body>
</html>

